@importc("cheng_abi_store_i32")
fn store(p: int64, v: int32)

@importc("cheng_abi_load_i32")
fn load(p: int64): int32

@importc("cheng_abi_call_cb_ctx_i32")
fn callCb(fn_ptr: void*, ctx: int64, a: int32, b: int32): int32

fn cb(ctx: int64, a: int32, b: int32): int32 =
    let x: int32 = load(ctx)
    let y: int32 = x + a + b
    store(ctx, y)
    return y

fn main(): int32 =
    var x: int32 = 0
    let px: int64 = &x
    store(px, 1)
    let r: int32 = callCb(&cb, px, 40, 2)
    if r != 43:
        return 1
    if load(px) != 43:
        return 2
    return 0
