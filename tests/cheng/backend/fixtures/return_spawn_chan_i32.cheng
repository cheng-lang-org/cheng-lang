import std/async_rt

var g_chan: chan_i32 = nil

@thread_boundary
fn producer() =
    chanI32Send(g_chan, 40)
    chanI32Send(g_chan, 2)

@thread_boundary
fn main(): int32 =
    g_chan = chanI32New 4
    spawn(producer)
    schedRun()
    var v0: int32 = 0
    var v1: int32 = 0
    if chanI32Recv(g_chan, v0) == 0:
        return 1
    if chanI32Recv(g_chan, v1) == 0:
        return 2
    return v0 + v1 - 42
