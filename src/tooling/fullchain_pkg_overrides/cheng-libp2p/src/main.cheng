# Fullchain override: minimal libp2p surface used by decentralized tool smoke.
# This keeps compile-time API compatibility while avoiding the heavy host stack.

import std/result
import cheng/libp2p/muxers/muxer

type
    Stream = muxer.Stream

    Switch =
        started: bool
        listenAddrText: str

fn initSwitch(text: str): Switch =
    Switch(started: false, listenAddrText: text)

fn newHost(): Result[Switch] =
    return Ok[Switch](initSwitch(""))

fn newHostWithAddressText(text: str): Result[Switch] =
    return Ok[Switch](initSwitch(text))

fn hostStart(sw: var Switch): Result[bool] =
    sw.started = true
    return Ok[bool](true)

fn hostStop(sw: var Switch) =
    sw.started = false

fn hostAcceptStream(sw: var Switch): Result[Stream] =
    sw
    return Err[Stream]("libp2p: stream accept disabled in fullchain override")

fn hostRunProtocolOnStream(sw: var Switch, stream: var Stream): Result[bool] =
    sw
    stream
    return Ok[bool](false)

fn hostOpenProtocolStreamToAddressText(
    sw: var Switch,
    addrText: str,
    codec: str
): Result[Stream] =
    sw
    addrText
    codec
    return Err[Stream]("libp2p: dial disabled in fullchain override")
