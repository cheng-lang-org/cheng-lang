# Machine IR facade: backed by machine internal core types.
# Export a stable machine surface so object writers do not import internals directly.
import cheng/backend/machine/machine_internal/machine_core_types
import std/result

type
    MachineReg = MachineCoreReg
    MachineCond = MachineCoreCond
    MachineOp = MachineCoreOp
    MachineInst = MachineCoreInst
    MachineFunc = MachineCoreFunc
    MachineCString = MachineCoreCString
    MachineGlobal = MachineCoreGlobal
    MachineModule = MachineCoreModule

fn Ok_MachineReg(value: MachineReg): Result[MachineReg] =
    var out: Result[MachineReg]
    out.ok = true
    out.value = value
    out.err = ErrorOk()
    return out

fn Err_MachineReg(err: str): Result[MachineReg] =
    var out: Result[MachineReg]
    out.ok = false
    out.err = ErrorNew(err)
    return out

fn Ok_MachineModule(value: MachineModule): Result[MachineModule] =
    var out: Result[MachineModule]
    out.ok = true
    out.value = value
    out.err = ErrorOk()
    return out

fn Err_MachineModule(err: str): Result[MachineModule] =
    var out: Result[MachineModule]
    out.ok = false
    out.err = ErrorNew(err)
    return out

fn ErrInfo_MachineModule(err: ErrorInfo): Result[MachineModule] =
    var out: Result[MachineModule]
    out.ok = false
    out.err = err
    return out

const
    machineRegW0: MachineReg = machineCoreRegW0
    machineRegW1: MachineReg = machineCoreRegW1
    machineRegW2: MachineReg = machineCoreRegW2
    machineRegW3: MachineReg = machineCoreRegW3
    machineRegW4: MachineReg = machineCoreRegW4
    machineRegW5: MachineReg = machineCoreRegW5
    machineRegW6: MachineReg = machineCoreRegW6
    machineRegW7: MachineReg = machineCoreRegW7
    machineRegW8: MachineReg = machineCoreRegW8
    machineRegX0: MachineReg = machineCoreRegX0
    machineRegX1: MachineReg = machineCoreRegX1
    machineRegX2: MachineReg = machineCoreRegX2
    machineRegX3: MachineReg = machineCoreRegX3
    machineRegX4: MachineReg = machineCoreRegX4
    machineRegX5: MachineReg = machineCoreRegX5
    machineRegX6: MachineReg = machineCoreRegX6
    machineRegX7: MachineReg = machineCoreRegX7
    machineRegX8: MachineReg = machineCoreRegX8
    machineRegX16: MachineReg = machineCoreRegX16
    machineRegX17: MachineReg = machineCoreRegX17
    machineRegX19: MachineReg = machineCoreRegX19
    machineRegX29: MachineReg = machineCoreRegX29
    machineRegX30: MachineReg = machineCoreRegX30
    machineRegSp: MachineReg = machineCoreRegSp
    machineRegD0: MachineReg = machineCoreRegD0
    machineRegD1: MachineReg = machineCoreRegD1
    machineRegEax: MachineReg = machineCoreRegEax
    machineRegEcx: MachineReg = machineCoreRegEcx
    machineRegEdx: MachineReg = machineCoreRegEdx
    machineRegEbx: MachineReg = machineCoreRegEbx
    machineRegEsi: MachineReg = machineCoreRegEsi
    machineRegEdi: MachineReg = machineCoreRegEdi
    machineRegR8d: MachineReg = machineCoreRegR8d
    machineRegR9d: MachineReg = machineCoreRegR9d
    machineRegR10d: MachineReg = machineCoreRegR10d
    machineRegR11d: MachineReg = machineCoreRegR11d
    machineRegR12d: MachineReg = machineCoreRegR12d
    machineRegR13d: MachineReg = machineCoreRegR13d
    machineRegR14d: MachineReg = machineCoreRegR14d
    machineRegR15d: MachineReg = machineCoreRegR15d
    machineRegRax: MachineReg = machineCoreRegRax
    machineRegRcx: MachineReg = machineCoreRegRcx
    machineRegRdx: MachineReg = machineCoreRegRdx
    machineRegRbx: MachineReg = machineCoreRegRbx
    machineRegRsi: MachineReg = machineCoreRegRsi
    machineRegRdi: MachineReg = machineCoreRegRdi
    machineRegRbp: MachineReg = machineCoreRegRbp
    machineRegR8: MachineReg = machineCoreRegR8
    machineRegR9: MachineReg = machineCoreRegR9
    machineRegR10: MachineReg = machineCoreRegR10
    machineRegR11: MachineReg = machineCoreRegR11
    machineRegR12: MachineReg = machineCoreRegR12
    machineRegR13: MachineReg = machineCoreRegR13
    machineRegR14: MachineReg = machineCoreRegR14
    machineRegR15: MachineReg = machineCoreRegR15

    machineCondEq: MachineCond = machineCoreCondEq
    machineCondNe: MachineCond = machineCoreCondNe
    machineCondMi: MachineCond = machineCoreCondMi
    machineCondLt: MachineCond = machineCoreCondLt
    machineCondLe: MachineCond = machineCoreCondLe
    machineCondGt: MachineCond = machineCoreCondGt
    machineCondGe: MachineCond = machineCoreCondGe
    machineCondLo: MachineCond = machineCoreCondLo
    machineCondLs: MachineCond = machineCoreCondLs
    machineCondHi: MachineCond = machineCoreCondHi
    machineCondHs: MachineCond = machineCoreCondHs

    machineOpLabel: MachineOp = machineCoreOpLabel
    machineOpMovImm: MachineOp = machineCoreOpMovImm
    machineOpMovReg: MachineOp = machineCoreOpMovReg
    machineOpSxtw: MachineOp = machineCoreOpSxtw
    machineOpAdrp: MachineOp = machineCoreOpAdrp
    machineOpAddPageOff: MachineOp = machineCoreOpAddPageOff
    machineOpAdd: MachineOp = machineCoreOpAdd
    machineOpSub: MachineOp = machineCoreOpSub
    machineOpMul: MachineOp = machineCoreOpMul
    machineOpSdiv: MachineOp = machineCoreOpSdiv
    machineOpUdiv: MachineOp = machineCoreOpUdiv
    machineOpMsub: MachineOp = machineCoreOpMsub
    machineOpAnd: MachineOp = machineCoreOpAnd
    machineOpOrr: MachineOp = machineCoreOpOrr
    machineOpEor: MachineOp = machineCoreOpEor
    machineOpLsl: MachineOp = machineCoreOpLsl
    machineOpLsr: MachineOp = machineCoreOpLsr
    machineOpAsr: MachineOp = machineCoreOpAsr
    machineOpCmp: MachineOp = machineCoreOpCmp
    machineOpBCond: MachineOp = machineCoreOpBCond
    machineOpB: MachineOp = machineCoreOpB
    machineOpBl: MachineOp = machineCoreOpBl
    machineOpBlr: MachineOp = machineCoreOpBlr
    machineOpFmovDx: MachineOp = machineCoreOpFmovDx
    machineOpFmovXd: MachineOp = machineCoreOpFmovXd
    machineOpFaddD: MachineOp = machineCoreOpFaddD
    machineOpFsubD: MachineOp = machineCoreOpFsubD
    machineOpFmulD: MachineOp = machineCoreOpFmulD
    machineOpFdivD: MachineOp = machineCoreOpFdivD
    machineOpFnegD: MachineOp = machineCoreOpFnegD
    machineOpFcmpD: MachineOp = machineCoreOpFcmpD
    machineOpScvtfDx: MachineOp = machineCoreOpScvtfDx
    machineOpSvc: MachineOp = machineCoreOpSvc
    machineOpRet: MachineOp = machineCoreOpRet
    machineOpStr: MachineOp = machineCoreOpStr
    machineOpLdr: MachineOp = machineCoreOpLdr
    machineOpStrb: MachineOp = machineCoreOpStrb
    machineOpLdrb: MachineOp = machineCoreOpLdrb
    machineOpLdrsb: MachineOp = machineCoreOpLdrsb
    machineOpStrh: MachineOp = machineCoreOpStrh
    machineOpLdrh: MachineOp = machineCoreOpLdrh
    machineOpLdrsh: MachineOp = machineCoreOpLdrsh
    machineOpSubSp: MachineOp = machineCoreOpSubSp
    machineOpAddSp: MachineOp = machineCoreOpAddSp

fn machineModuleTargetOf(module: MachineModule): str =
    return machineCoreModuleTargetOf(module)

fn machineModuleFuncsLen(module: MachineModule): int32 =
    return machineCoreModuleFuncsLen(module)

fn machineModuleFuncAt(module: MachineModule, idx: int32): MachineFunc =
    let coreModule: MachineCoreModule = module
    return coreModule.funcs[idx]

fn machineModuleCstrsLen(module: MachineModule): int32 =
    return machineCoreModuleCstrsLen(module)

fn machineModuleCStringAt(module: MachineModule, idx: int32): MachineCString =
    let coreModule: MachineCoreModule = module
    return coreModule.cstrs[idx]

fn machineModuleGlobalsLen(module: MachineModule): int32 =
    return machineCoreModuleGlobalsLen(module)

fn machineModuleGlobalAt(module: MachineModule, idx: int32): MachineGlobal =
    let coreModule: MachineCoreModule = module
    return coreModule.globals[idx]

fn machineFuncNameOf(func: MachineFunc): str =
    return machineCoreFuncNameOf(func)

fn machineFuncInstsLen(func: MachineFunc): int32 =
    return machineCoreFuncInstsLen(func)

fn machineFuncInstAt(func: MachineFunc, idx: int32): MachineInst =
    let coreFunc: MachineCoreFunc = func
    return coreFunc.insts[idx]

fn machineCStringLabelOf(c: MachineCString): str =
    return machineCoreCStringLabelOf(c)

fn machineCStringValueOf(c: MachineCString): str =
    return machineCoreCStringValueOf(c)

fn machineGlobalNameOf(g: MachineGlobal): str =
    return machineCoreGlobalNameOf(g)

fn machineGlobalSizeOf(g: MachineGlobal): int32 =
    return machineCoreGlobalSizeOf(g)

fn machineGlobalAlignPow2Of(g: MachineGlobal): int32 =
    return machineCoreGlobalAlignPow2Of(g)

fn machineGlobalInitOf(g: MachineGlobal): int64 =
    return machineCoreGlobalInitOf(g)

fn machineGlobalHasInit(g: MachineGlobal): bool =
    return machineCoreGlobalHasInit(g)

fn machineInstOpOf(inst: MachineInst): MachineOp =
    return machineCoreInstOpOf(inst)

fn machineInstRdOf(inst: MachineInst): MachineReg =
    return machineCoreInstRdOf(inst)

fn machineInstRnOf(inst: MachineInst): MachineReg =
    return machineCoreInstRnOf(inst)

fn machineInstRmOf(inst: MachineInst): MachineReg =
    return machineCoreInstRmOf(inst)

fn machineInstRaOf(inst: MachineInst): MachineReg =
    return machineCoreInstRaOf(inst)

fn machineInstImmOf(inst: MachineInst): int64 =
    return machineCoreInstImmOf(inst)

fn machineInstLabelOf(inst: MachineInst): str =
    return machineCoreInstLabelOf(inst)

fn machineInstCondOf(inst: MachineInst): MachineCond =
    return machineCoreInstCondOf(inst)
