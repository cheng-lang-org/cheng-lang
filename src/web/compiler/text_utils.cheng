import std/strings

fn minI32(a, b: int32): int32 =
    if a < b:
        return a
    return b

fn isWhitespace(c: char): bool =
    return c == ' ' || c == '\t' || c == '\n' || c == '\r'

fn skipWhitespace(s: str, start: int32): int32 =
    for i in start..<len(s):
        if ! isWhitespace(s[i]):
            break
    return i

fn startsWithAt(s: str, prefix: str, start: int32): bool =
    if start < 0:
        return false
    if len(prefix) == 0:
        return true
    if start + len(prefix) > len(s):
        return false
    for i in 0..<len(prefix):
        if s[start + i] != prefix[i]:
            return false
    return true

fn indexOfSubstr(s: str, needle: str, start: int32): int32 =
    let nLen: int32 = len(needle)
    if nLen == 0:
        return start
    let sLen: int32 = len(s)
    if start < 0 || start >= sLen:
        return -1
    if nLen > sLen:
        return -1
    var i: int32 = start
    let limit: int32 = sLen - nLen
    let __for_start_i_1 = i
    for __for_i_1 in __for_start_i_1..limit:
        i = __for_i_1
        var j: int32 = 0
        var matched: bool = true
        let __for_guard_start_j_1 = j
        for __for_guard_j_1 in __for_guard_start_j_1..<nLen:
            if ! (j < nLen):
                break
            if s[i + j] != needle[j]:
                matched = false
                break
            j = j + 1
        if matched:
            return i
        i = i + 1
    return -1

fn substr(s: str, start: int32, count: int32): str =
    if count <= 0:
        return ""
    let sLen: int32 = len(s)
    if start < 0 || start >= sLen:
        return ""
    let n: int32 = minI32(count, sLen - start)
    let out: void* = alloc(n + 1)
    copyMem(out, ptr_add(s, start), n)
    setMem(ptr_add(out, n), 0, 1)
    return str(out)

fn trim(s: str): str =
    if len(s) == 0:
        return ""
    var start: int32 = 0
    var stop: int32 = len(s) - 1
    let __for_start_start_2 = start
    for __for_start_2 in __for_start_start_2..stop:
        start = __for_start_2
        if ! (start <= stop && isWhitespace(s[start])):
            break
        start = start + 1
    let __for_start_stop_3 = stop
    for __for_stop_3 in 0..(__for_start_stop_3 - (start)):
        stop = __for_start_stop_3 - __for_stop_3
        if ! (stop >= start && isWhitespace(s[stop])):
            break
        stop = stop - 1
    if stop < start:
        return ""
    return substr(s, start, stop - start + 1)

fn isNameChar(c: char): bool =
    if c >= 'a' && c <= 'z':
        return true
    if c >= 'A' && c <= 'Z':
        return true
    if c >= '0' && c <= '9':
        return true
    if c == '_' || c == '-' || c == ':' || c == '.':
        return true
    return false
