# std/json (minimal, pure Cheng)
import cheng/runtime/json_ast as json_ast
import cheng/runtime/json_runtime as json_runtime
import cheng/runtime/json_compat as json_compat
type
    JsonNode = json_ast.JsonNode
type
    JsonNodeKind = json_ast.JsonNodeKind
type
    JsonValue = json_ast.JsonValue
type
    JsonParseResult = json_runtime.JsonParseResult
const
    JNull: JsonNodeKind = json_ast.JNull
    JBool: JsonNodeKind = json_ast.JBool
    JInt: JsonNodeKind = json_ast.JInt
    JFloat: JsonNodeKind = json_ast.JFloat
    JString: JsonNodeKind = json_ast.JString
    JArray: JsonNodeKind = json_ast.JArray
    JObject: JsonNodeKind = json_ast.JObject
    jkNull: JsonNodeKind = json_ast.jkNull
    jkBool: JsonNodeKind = json_ast.jkBool
    jkInt: JsonNodeKind = json_ast.jkInt
    jkFloat: JsonNodeKind = json_ast.jkFloat
    jkString: JsonNodeKind = json_ast.jkString
    jkArray: JsonNodeKind = json_ast.jkArray
    jkObject: JsonNodeKind = json_ast.jkObject
fn newJNull(): JsonNode =
    json_ast.newJNull()
fn newJBool(value: bool): JsonNode =
    json_ast.newJBool value
fn newJInt(value: int64): JsonNode =
    json_ast.newJInt value
fn newJFloat(value: float64): JsonNode =
    json_ast.newJFloat value
fn newJString(value: str): JsonNode =
    json_ast.newJString value
fn newJArray(): JsonNode =
    json_ast.newJArray()
fn newJObject(): JsonNode =
    json_ast.newJObject()
fn jsonNil(): JsonNode =
    json_ast.jsonNil()
fn jsonBool(value: bool): JsonNode =
    json_ast.jsonBool value
fn jsonNumber(value: float64): JsonNode =
    json_ast.jsonNumber value
fn jsonString(value: str): JsonNode =
    json_ast.jsonString value
fn jsonArray(items: JsonNode[]): JsonNode =
    json_ast.jsonArray items
fn jsonObject(pairs: json_ast.JsonPair[]): JsonNode =
    json_ast.jsonObject pairs
fn add(node: JsonNode, item: JsonNode) =
    json_ast.add(node, item)
fn len(node: JsonNode): int =
    json_ast.len node
fn hasKey(node: JsonNode, key: str): bool =
    json_ast.hasKey(node, key)
fn `[]`(node: JsonNode, key: str): JsonNode =
    json_ast.jsonGetField(node, key)
fn `[]=`(node: JsonNode, key: str, value: JsonNode) =
    json_ast.jsonSetField(node, key, value)
fn `[]=`(node: JsonNode, key: str, value: str) =
    json_ast.jsonSetField(node, key, json_ast.toJsonValue(value))
fn `[]=`(node: JsonNode, key: str, value: bool) =
    json_ast.jsonSetField(node, key, json_ast.toJsonValue(value))
fn `[]=`(node: JsonNode, key: str, value: int) =
    json_ast.jsonSetField(node, key, json_ast.toJsonValue(value))
fn `[]=`(node: JsonNode, key: str, value: int32) =
    json_ast.jsonSetField(node, key, json_ast.toJsonValue(value))
fn `[]=`(node: JsonNode, key: str, value: int64) =
    json_ast.jsonSetField(node, key, json_ast.toJsonValue(value))
fn `[]=`(node: JsonNode, key: str, value: float64) =
    json_ast.jsonSetField(node, key, json_ast.toJsonValue(value))
fn getInt(node: JsonNode): int64 =
    json_ast.getInt node
fn getInt64(node: JsonNode): int64 =
    json_ast.getInt node
fn getInt64(node: JsonNode, fallback: int64): int64 =
    if node == nil:
        return fallback
    if node.kind == JInt:
        return node.getInt64()
    if node.kind == JFloat:
        return int64(node.getFloat())
    return fallback
fn getBool(node: JsonNode): bool =
    json_ast.getBool node
fn getBool(node: JsonNode, fallback: bool): bool =
    if node == nil:
        return fallback
    if node.kind == JBool:
        return node.getBool()
    return fallback
fn getFloat(node: JsonNode): float64 =
    json_ast.getFloat node
fn getStr(node: JsonNode): str =
    json_ast.getStr node
fn getStr(node: JsonNode, fallback: str): str =
    if node == nil:
        return fallback
    if node.kind == JString:
        return node.getStr()
    return fallback
fn getStrArray(node: JsonNode): str[] =
    var out: str[]
    if node == nil || node.kind != JArray:
        return out
    for item in node.a:
        let value: str = item.getStr("")
        if len(value) > 0:
            out.add(value)
    return out
fn getStrArray(node: JsonNode, key: str): str[] =
    return getStrArray(node[key])
fn `%`(node: JsonNode): JsonNode =
    node
fn `%`(value: str): JsonNode =
    json_ast.toJsonValue value
fn `%`(value: bool): JsonNode =
    json_ast.toJsonValue value
fn `%`(value: int): JsonNode =
    json_ast.toJsonValue value
fn `%`(value: int32): JsonNode =
    json_ast.toJsonValue value
fn `%`(value: int64): JsonNode =
    json_ast.toJsonValue value
fn `%`(value: float64): JsonNode =
    json_ast.toJsonValue value
fn toJsonNode(node: JsonNode): JsonNode =
    json_ast.toJsonNode node
fn toJsonValue(node: JsonNode): JsonNode =
    json_ast.toJsonValue node
fn toJsonValue(value: str): JsonNode =
    json_ast.toJsonValue value
fn toJsonValue(value: bool): JsonNode =
    json_ast.toJsonValue value
fn toJsonValue(value: int): JsonNode =
    json_ast.toJsonValue value
fn toJsonValue(value: int32): JsonNode =
    json_ast.toJsonValue value
fn toJsonValue(value: int64): JsonNode =
    json_ast.toJsonValue value
fn toJsonValue(value: float64): JsonNode =
    json_ast.toJsonValue value
fn toJsonValue(value: T[]): JsonNode =
    json_ast.toJsonValue value
fn pretty(node: JsonNode, indent: int): str =
    json_ast.pretty(node, indent)
fn pretty(node: JsonNode): str =
    json_ast.pretty(node, 2)
fn toPretty(node: JsonNode, indent: int): str =
    json_ast.toPretty(node, indent)
fn toPretty(node: JsonNode): str =
    json_ast.toPretty(node, 2)
fn `$`(node: JsonNode): str =
    pretty node
fn parseJson(content: str): JsonNode =
    json_runtime.parseJson content
fn parseJsonNode(content: str): JsonNode =
    json_runtime.parseJsonNode content
fn parseJsonSafe(content: str): JsonParseResult =
    json_runtime.parseJsonSafe content
fn jsonField(key: str, value: JsonNode): json_compat.CompatJsonPair =
    json_compat.jsonField(key, value)
fn jsonField(key: str, value: str): json_compat.CompatJsonPair =
    json_compat.jsonField(key, value)
fn jsonField(key: str, value: int): json_compat.CompatJsonPair =
    json_compat.jsonField(key, value)
fn jsonField(key: str, value: int32): json_compat.CompatJsonPair =
    json_compat.jsonField(key, int(value))
fn jsonField(key: str, value: float64): json_compat.CompatJsonPair =
    json_compat.jsonField(key, value)
fn jsonField(key: str, value: bool): json_compat.CompatJsonPair =
    json_compat.jsonField(key, value)
fn jsonObjectLit(fields: varargs[json_compat.CompatJsonPair]): JsonNode =
    json_compat.jsonObjectLit fields
fn jsonArrayLit(items: JsonNode[]): JsonNode =
    json_compat.jsonArrayLit items
fn jsonArrayLit(items: varargs[JsonNode]): JsonNode =
    json_compat.jsonArrayLit items
fn jsonValue(value: JsonNode): JsonNode =
    json_compat.jsonValue value
fn jsonValue(value: str): JsonNode =
    json_compat.jsonValue value
fn jsonValue(value: int): JsonNode =
    json_compat.jsonValue value
fn jsonValue(value: int32): JsonNode =
    json_compat.jsonValue int(value)
fn jsonValue(value: float64): JsonNode =
    json_compat.jsonValue value
fn jsonValue(value: bool): JsonNode =
    json_compat.jsonValue value
fn jsonField(key: str, value: T[]): json_compat.CompatJsonPair =
    json_compat.jsonField(key, value)
