# system_c: minimal system subset for direct C backend
import std/result

type
    cstring = char*
    str = char*
type
    int8 = int8
    int16 = int16
    int32 = int32
    int64 = int64
type
    uint8 = uint8
    uint16 = uint16
    uint32 = uint32
    uint64 = uint64

@importc("cheng_puts")
fn c_puts(text: cstring): int32
@importc("cheng_exit")
fn c_exit(code: int32)

fn echo(text: str) =
    c_puts text

fn panic(text: str) =
    echo text
    c_exit 1
fn panic(err: result.ErrorInfo) =
    panic result.ErrorFormat(err)

@importc("cheng_malloc")
fn malloc(size: int32): void*
@importc("cheng_free")
fn free(p: void*)
@importc("cheng_realloc")
fn realloc(p: void*, size: int32): void*
@importc("cheng_seq_get")
fn cheng_seq_get(buffer: void*, len: int32, idx: int32, elemSize: int32): void*
@importc("cheng_memset")
fn c_memset(dest: void*, val: int32, n: int64): void*

fn alloc(size: int32): void* =
    return malloc size

fn dealloc(p: void*) =
    free p

fn zeroMem(dest: void*, size: int) =
    c_memset(dest, 0, int64(size))
